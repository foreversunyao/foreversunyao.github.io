---
layout: post
title: "K8s pv"
date: 2022-03-27 21:25:06
description: pv, pvc, storage class
tags:
 - k8s
---

[refer](https://www.alibabacloud.com/blog/kubernetes-persistent-storage-process_596505)

**claim process**
![img]({{ '/assets/images/cloud/k8s_pv_4.png' | relative_url }}){: .center-image }*(°0°)*

1) A user creates a pod that contains a PVC, which uses a dynamic PV.
2) Scheduler schedules the pod to an appropriate worker node based on the pod configuration, node status, and PV configuration.
3) PV Controller watches that the pod-used PVC is in the Pending state and calls Volume Plugin (in-tree) to create a PV and PV object. The out-of-tree process is implemented by External Provisioner.
4) AD Controller detects that the pod and PVC are in the 'To Be Attached' state and calls Volume Plugin to attach the storage device to the target worker node.
5) On the worker node, Volume Manager in the kubelet waits until the storage device is attached and uses Volume Plugin to mount the device to the global directory `/var/lib/kubelet/pods/[pod uid]/volumes/kubernetes.io~iscsi/[PV
name]` (iscsi is used as an example).
6) The kubelet uses Docker to start the containers in the pod and uses the bind mount method to map the volume that is mounted to the local-global directory to the containers.

**pv, pvc, sc**
![img]({{ '/assets/images/cloud/k8s_pv_1.png' | relative_url }}){: .center-image }*(°0°)*


**static pv vs dynamic pv**
![img]({{ '/assets/images/cloud/k8s_pv_3.png' | relative_url }}){: .center-image }*(°0°)*

